---
layout: docs
language: ko
category: 운영체제
title: 메모리
meta: Memory
order: 0x41
---
# 메모리 관리
32비트 윈도우 OS에서의 각 프로세스는 최대 4GB 메모리까지 도달할 수 있는 가상주소공간을 갖는다.

64비트 윈도우 OS에서의 각 프로세스는 최대 8TB 메모리까지 도달할 수 있는 가상주소공간을 갖는다.

모든 프로세스의 쓰레드는 이 가상주소공간에 접근할 수 있으나 다른 프로세스의 가상주소공간에는 접근할 수 없다. 이를 통해 한 프로세스가 다른 프로세스에 영향을 주는 것을 방지한다.

## 가장주소공간
프로세스를 위한 가상주소공간은 프로세스가 사용할 수 있는 가상 메모리 주소의 집합이다. 각 프로세스의 주소공간은 private으로 공유하지 않는 이상 다른 프로세스가 접속할 수 없다.

가상주소는 메모리에 소재하는 객체의 실제 물리적 위치를 반영하지 않는다. 시스템이 각 프로세스에 대한 페이지 테이블을 관리한다.

> 페이지 테이블은 가상주소를 대응하는 물리적 주소로 변환시켜주는 내부 데이터 구조이다.

매번 쓰레드가 주소를 참조할 때, 시스템은 가상주소를 물리적 주소로 변환한다.

32비트 윈도우에서의 가상주소공간은 4GB 크기로 두 파티션으로 나뉘어 사용된다: 하나는 프로세스를 위한 것이며, 다른 하나는 시스템을 위한 reserved된 공간이다.

### 가상주소공간과 물리적 저장장치
운영체제 버전에 따라 마이크로소프트 윈도우가 지원하는 최대 물리 메모리(e.g. RAM)은 2GB ~ 24TB이다. 각 프로세스의 가상주소공간은 컴퓨터에서 사용할 수 있는 총 물리 메모리 용량보다 작거나 클 수 있다. 프로세스의 가상주소공간 일부 중 물리 메모리에 위치한 것은 working set이라고 칭한다. 프로세스의 쓰레드가 현재 물리 메모리에서 제공할 수 있는 용량 이상을 요구하면 시스템은 일부 메모리 내용을 저장장치로 page한다. 즉, 프로세스가 사용할 수 있는 총 가상주소공간 용량은 물리 메모리 + 저장장치의 빈 공간(일명 pagefile)이다.

> 페이지(page)란, 일정한 크기로 나뉘어진 운영체제에서 관리하는 가장 작은 단위의 가상 메모리이다. 크기는 호스트 시스템마다 다르며 x86 컴퓨터의 경우에는 4kB이다.

> pagefile 명칭은 가상 메모리의 page가 file을 저장하는 저장장치에서 처리하기 때문에 이 두 용어를 통합한 것으로 보인다; page를 가리키는 file.

메모리 관리의 유연성을 최대화하기 위해, 시스템은 물리 메모리의 페이지에서 저장장치의 페이지파일로 혹은 그 반대로도 이동시킬 수 있다. 물리 메모리의 페이지로 옮겨지면 시스템은 이로부터 영향을 받은 프로세스의 페이지 맵을 업데이트 시킨다. 만일 시스템이 물리 메모리를 필요로 한다면 가장 오랫동안 사용되지 않은 물리 메모리 페이지를 페이지파일로 옮긴다. 이러한 시스템에 의한 물리 메모리의 변동은 가상주소공간에서만 동작하는 어플리케이션 관점에서는 알아챌 수 없다.

### Working Set
Working set는 프로세스 가상주소공간 중에서 물리 메모리에 머물고 있는 페이지 집합이다. Working set는 페이지될 수 있는 메모리 할당만을 포함하며, (Address Windowing Extension이나 large page allocation 등의) 페이지 될 수 없는 메모리 할당은 working set에서 제외된다.

프로세스가 working set가 아닌 페이지될 수 있는 메모리를 참조하면 page fault(페이지 부재)가 발생한다. 시스템의 page fault 처리자는 page fault를 해결하려 하며, 성공할 시 해당 페이지는 working set에 추가된다 (AWE 또는 large page allocation 접근은 페이지될 수 있는 메모리가 아니기 때문에 항상 물리 메모리에 있어 page fault 문제가 발생하지 않는다).

Hard page fault는 페이지의 backing store로부터 페이지 내용(페이지파일 혹은 프로세스로 생성된 메모리 맵 파일)을 읽어서만 문제를 해결할 수 있다. Soft page fault는 backing store를 접근하지 않고서도 해결될 수 있다.

> Backing store이란, 저장장치 중에서 페이징 및 스와핑에 사용되는 공간이다.

Soft page fault는 다음과 같은 이유로 발생한다.

* 
